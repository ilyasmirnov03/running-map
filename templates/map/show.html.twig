{% extends 'map.html.twig' %}

{% block title %}{{run.name}}{% endblock %}

{% block body %}
    <style>
        html, body {
            margin: 0;
        }
        #map {
            height: 50vh;
            width: 50vw;
            box-sizing: border-box;
        }
    </style>

    <div id="map"></div>
    <div>
        {% if run.finishedAt %}
            <input class="time-choice" type="range" value="{{run.runDate|date('U')}}" min="{{run.runDate|date('U')}}" max="{{run.finishedAt|date('U')}}">
        {% endif %}
        <p>Debut de course : {{run.runDate|date('Y-m-d H:i:s')}}</p>
        <p>Fin de course : {{run.finishedAt ? run.finishedAt|date('Y-m-d H:i:s') : "la course n'est pas terminee."}}</p>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', async () => {
            //run data
            await Run.init( {{ { 'id': run.id, 'name': run.name, 'created_at': run.createdAt,'map': run.map, 'date': run.runDate }|json_encode()|raw }} );
            //run progress showcase with range slider
            let timer;
            document.querySelector('.time-choice').addEventListener('input', function()  {
                clearTimeout(timer);
                //fetch only half a second after selecting
                timer = setTimeout(() => {
                    fetch(`/coords/{{ run.id }}/${this.value}`)
                        .then((res) =>  res.json())
                        .then((data) => console.log(data));
                }, 500);
            });
        });
    </script>
{% endblock %}